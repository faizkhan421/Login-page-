<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Final Step</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <style>
    body { font-family: Arial; text-align: center; padding: 40px; }
    #getLinkBtn { display: none; }
  </style>
</head>
<body>
  <h2>Final Step: Wait 5 Seconds</h2>
  <p id="timer">5</p>
  <button id="getLinkBtn" onclick="redirectToLink()">Get Link</button>

  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let seconds = 5;
    const timer = document.getElementById("timer");
    const getLinkBtn = document.getElementById("getLinkBtn");

    const countdown = setInterval(() => {
      seconds--;
      timer.textContent = seconds;
      if (seconds <= 0) {
        clearInterval(countdown);
        getLinkBtn.style.display = "inline-block";
      }
    }, 1000);

    function redirectToLink() {
      const code = new URLSearchParams(window.location.search).get("code");
      db.collection("shortLinks").doc(code).get().then((doc) => {
        if (doc.exists) {
          const originalURL = doc.data().url;
          window.location.href = originalURL;
        } else {
          alert("Link not found.");
        }
      });
    }
  </script>
</body>
</html>
